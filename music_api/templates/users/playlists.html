{% extends "base.html" %}

{% load compress %}
{% load static %}

{% block title %}My Playlists - RubySound.fm{% endblock %}

{% block content %}

<div class="container mt-md-3">
    <nav aria-label="breadcrumb" class="mb-3 mt-3 ruby-breadcrumb pre-animation">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
                <a href="{% url 'home' %}">Главная</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">Плейлисты</li>
        </ol>
    </nav>
    <div class="d-lg-none mb-3 playlist-mobile-filter-wrap">
        <button
            class="btn btn-outline-danger btn-sm playlist-filter-mobile-trigger pre-animation"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#playlistFilterOffcanvas"
            aria-controls="playlistFilterOffcanvas"
        >
            <i class="bi bi-sliders me-1"></i> Фильтры
        </button>
    </div>

    <div class="row g-3 g-lg-4 align-items-start playlist-layout">
        <aside class="col-12 col-lg-4 col-xl-3 d-none d-lg-block">
            <section class="playlist-filter-card pre-animation" id="playlist-filter-panel">
                <h3 class="playlist-filter-title mb-4">
    <i class="bi bi-funnel me-2 text-danger"></i>Фильтр и сортировка
</h3>

                <div class="mb-3">
                    <label class="form-label mb-1" for="playlist-title-input">Название плейлиста</label>
                    <div class="d-flex gap-2">
                        <input
                            type="text"
                            class="form-control form-control-sm"
                            id="playlist-title-input"
                            value="{{ playlist.title|default:'Favorites' }}"
                            maxlength="255"
                            data-playlist-title-input
                        >
                        <button type="button" class="btn btn-sm btn-outline-danger" data-playlist-title-save>
                            Сохранить
                        </button>
                    </div>
                </div>

                <hr class="text-muted my-3">

                <div class="mb-3">
                    <label class="form-label mb-1" for="playlist-sort">Сортировка</label>
                    <select class="form-select form-select-sm" id="playlist-sort" data-playlist-sort>
                        <option value="new">Сначала новые</option>
                        <option value="old">Сначала старые</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label mb-1" for="playlist-artist-filter">Артист</label>
                    <select class="form-select form-select-sm" id="playlist-artist-filter" data-playlist-artist-filter>
                        <option value="all">Все артисты</option>
                    </select>
                </div>

                <hr class="text-muted my-3">

                <div class="mb-2">
                    <button type="button" class="btn btn-sm btn-outline-danger mx-auto d-block" data-playlist-reset-filters>
                        Очистить
                    </button>
                </div>

                <hr class="text-muted my-3">

                <div class="mb-2">
                    <label class="form-label mb-1">Количество треков</label>
                    <div class="small text-muted" id="playlist-count-display" data-playlist-count-display>0</div>
                </div>

                <div id="playlist-filter-meta" class="small text-muted mt-3" data-playlist-filter-meta></div>
            </section>
        </aside>

        <section class="col-12 col-lg-8 col-xl-9">
            <div id="playlists-root" class="playlist-scroll-wrapper mb-3">

                {% if tracks %}

                    <ul class="track-list list-unstyled p-0 m-0">

                        {% for track in tracks %}
                            <li class="track-item-playlist pre-animation"
                                data-track-index="{{ forloop.counter0 }}">

                                <div class="track-playlist mb-3"
                                     data-track-name="{{ track.name|default:''|escape }}"
                                     data-track-artist="{{ track.artist|default:''|escape }}"
                                     {% if track.mbid %}data-track-mbid="{{ track.mbid|escape }}"{% endif %}>

                                    <img
                                            src="{{ track.image_url|default:'/static/images/default.svg' }}"
                                            alt="{{ track.name|default:'Unknown track' }}"
                                            class="track-image shadow-sm img-fluid"
                                            loading="lazy"
                                    >

                                    <div class="track-meta">
                                        <h5 class="track-title text-start">{{ track.name|default:"Unknown track" }}</h5>
                                        <p class="track-artist">
                                            <span class="track-artist-label">Артист:</span>
                                            <button
                                                type="button"
                                                class="artist-bio-trigger js-artist-bio-trigger color-dark"
                                                data-artist-name="{{ track.artist|default:'Unknown artist'|escape }}"
                                                aria-label="Показать биографию артиста {{ track.artist|default:'Unknown artist' }}">{{ track.artist|default:"Unknown artist" }}</button>
                                        </p>
                                    </div>

                                    <div class="track-player me-sm-2">
                                        {% if track.url %}
                                            <audio controls preload="none"
                                                   style="filter: sepia(1) saturate(2) hue-rotate(320deg);">
                                                <source src="{{ track.url }}">
                                            </audio>
                                        {% else %}
                                            <div class="fs-6 text-muted d-inline-block border-bottom border-danger">
                                                Превью недоступно
                                            </div>
                                        {% endif %}
                                    </div>

                                    <div class="track-actions">
                                        <button type="button"
                                                class="btn btn-outline-danger btn-sm remove-favorite-btn ms-sm-2"
                                                aria-label="Удалить трек">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>

                                </div>

                            </li>
                        {% endfor %}

                    </ul>

                {% else %}
                    <div class="alert alert-secondary mb-0">
                        У вас пока нет избранных треков.
                    </div>
                {% endif %}
            </div>
        </section>
    </div>
</div>

<div class="offcanvas offcanvas-bottom playlist-filter-offcanvas d-lg-none" tabindex="-1" id="playlistFilterOffcanvas"
     aria-labelledby="playlistFilterOffcanvasLabel">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="playlistFilterOffcanvasLabel">Фильтр и сортировка</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <div class="mb-4">
            <label class="form-label mb-1" for="playlist-title-mobile">
                <i class="bi bi-music-note-list me-2 text-danger"></i>Название плейлиста
            </label>
            <div class="d-flex gap-2">
                <input
                    type="text"
                    class="form-control form-control-sm"
                    id="playlist-title-mobile"
                    value="{{ playlist.title|default:'Favorites' }}"
                    maxlength="255"
                    data-playlist-title-input
                >
                <button type="button" class="btn btn-sm btn-outline-danger" data-playlist-title-save>
                    Сохранить
                </button>
            </div>
        </div>

        <div class="mb-4">
            <label class="form-label" for="playlist-sort-mobile">
                <i class="bi bi-sort-down me-2 text-danger"></i>Сортировка
            </label>
            <select class="form-select form-select-sm" id="playlist-sort-mobile" data-playlist-sort>
                <option value="new">Сначала новые</option>
                <option value="old">Сначала старые</option>
            </select>
        </div>

        <div class="mb-4">
            <label class="form-label mb-1" for="playlist-artist-filter-mobile">
                <i class="bi bi-person me-2 text-danger"></i>Артист
            </label>
            <select class="form-select form-select-sm" id="playlist-artist-filter-mobile" data-playlist-artist-filter>
                <option value="all">Все артисты</option>
            </select>
        </div>

        <div class="mb-4">
            <button type="button" class="btn btn-sm btn-outline-danger mx-auto d-block" data-playlist-reset-filters>
                <i class="bi bi-arrow-clockwise me-1"></i>Очистить
            </button>
        </div>

        <div class="mb-4">
            <label class="form-label mb-1">
            Количество треков
            </label>
            <div class="small text-white d-md-none" data-playlist-count-display>0</div>
            <div class="small text-muted d-none d-md-block" data-playlist-count-display>0</div>
        </div>

        <div class="small text-white mt-3 d-md-none text-center" data-playlist-filter-meta></div>
        <div class="small text-muted mt-3 d-none d-md-block text-center" data-playlist-filter-meta></div>
    </div>
</div>

{% endblock %}
